(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function t(e){var t=e.parentNode.querySelector(".".concat(e.name,"-error"));return t||((t=document.createElement("span")).className="".concat(e.name,"-error popup__error"),e.parentNode.appendChild(t)),t}function n(e,n){var r=t(e);e.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}function r(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function o(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach((function(e){return n(e,t)})),r(o,c,t)}var c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-35",headers:{authorization:"2a0472aa-7748-4657-8174-bc4f6caabc25","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return(t=function(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p,d=document.querySelector(".popup_type_edit"),f=d.querySelector(".popup__form"),_=f.querySelector(".popup__input_type_name"),m=f.querySelector(".popup__input_type_description"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),b=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__image"),S=document.querySelector(".popup_type_new-card"),k=S.querySelector(".popup__form"),g=k.querySelector(".popup__input_type_card-name"),q=k.querySelector(".popup__input_type_url"),E=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_image"),L=C.querySelector(".popup__image"),j=C.querySelector(".popup__caption"),x=document.querySelector(".places__list"),O=document.querySelector("#card-template").content,P=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}];function w(e){e.classList.add("popup_is-opened")}function D(e){e.classList.remove("popup_is-opened")}function A(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function U(e){var t=O.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image"),r=t.querySelector(".card__title"),o=t.querySelector(".card__like-button"),i=t.querySelector(".card__delete-button"),u=document.createElement("span");return u.classList.add("card__like-count"),t.querySelector(".card__description").appendChild(u),n.src=e.link,n.alt=e.name,r.textContent=e.name,u.textContent=e.likes?e.likes.length:0,e.likes&&e.likes.some((function(e){return e._id===p}))&&o.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==p&&(i.style.display="none"),o.addEventListener("click",(function(){return function(e,t,n){var r=t.classList.contains("card__like-button_is-active");(r?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(e):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(e)).then((function(e){t.classList.toggle("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(o){if(console.error("Ошибка при обработке лайка:",o),e.startsWith("local-")){var c=parseInt(n.textContent,10);t.classList.toggle("card__like-button_is-active"),n.textContent=r?c-1:c+1}}))}(e._id,o,u)})),i.addEventListener("click",(function(){return function(e,t){t.startsWith("local-")?e.remove():function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(t).then((function(){return e.remove()})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)}))}(t,e._id)})),n.addEventListener("click",(function(){L.src=e.link,L.alt=e.name,j.textContent=e.name,w(C)})),t}function T(e){x.prepend(e)}function B(){P.forEach((function(e){T(U(s(s({},e),{},{owner:{_id:p||"local-user"},likes:[],_id:"local-".concat(e.name)})))}))}b.addEventListener("click",(function(){console.log("Кнопка редактирования профиля нажата"),w(d),_.value=y.textContent,m.value=v.textContent,o(f,e)})),E.addEventListener("click",(function(){console.log("Кнопка добавления карточки нажата"),w(S),k.reset(),o(k,e)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){console.log("Кнопка закрытия попапа нажата"),D(e.closest(".popup"))}))})),fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a).then((function(e){p=e._id,y.textContent=e.name,v.textContent=e.about,h.style.backgroundImage="url(".concat(e.avatar,")"),B()})).catch((function(e){console.error("Ошибка при загрузке данных пользователя:",e),p="local-user",B()})),f.addEventListener("submit",(function(e){e.preventDefault(),console.log("Форма редактирования профиля отправлена");var t,n,r=f.querySelector(".popup__button");A(!0,r),(t=_.value,n=m.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then(a)).then((function(e){y.textContent=e.name,v.textContent=e.about,D(d)})).catch((function(e){return console.error("Ошибка при сохранении профиля:",e)})).finally((function(){A(!1,r),r.disabled=!1}))})),k.addEventListener("submit",(function(t){t.preventDefault(),console.log("Форма добавления карточки отправлена");var n,r,i=k.querySelector(".popup__button");A(!0,i),(n=g.value,r=q.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n,link:r})}).then(a)).then((function(t){T(U(t)),D(S),k.reset(),o(k,e)})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})).finally((function(){A(!1,i),i.disabled=!1}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(o){o.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,o){var c=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(c,a,o),c.forEach((function(e){e.addEventListener("input",(function(){(function(e,r,o){r.validity.valid?n(r,o):function(e,n,r){var o=t(e);e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(r,r.validationMessage,o)})(0,e,o),r(c,a,o)}))}))}(o,e)}))}(e)})();