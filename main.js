(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function t(e){var t=e.parentNode.querySelector(".".concat(e.name,"-error"));return t||((t=document.createElement("span")).className="".concat(e.name,"-error popup__error"),e.parentNode.appendChild(t)),t}function n(e,n){var r=t(e);e.classList.remove(n.inputErrorClass),r.textContent="",r.classList.remove(n.errorClass)}function r(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function o(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach((function(e){return n(e,t)})),r(o,c,t)}var c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-35",headers:{authorization:"2a0472aa-7748-4657-8174-bc4f6caabc25","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u,i=document.querySelector(".popup_type_edit"),l=i.querySelector(".popup__form"),s=l.querySelector(".popup__input_type_name"),d=l.querySelector(".popup__input_type_description"),p=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__image"),y=document.querySelector(".popup_type_new-card"),h=y.querySelector(".popup__form"),v=h.querySelector(".popup__input_type_card-name"),S=h.querySelector(".popup__input_type_url"),b=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_image"),C=q.querySelector(".popup__image"),E=q.querySelector(".popup__caption"),L=document.querySelector(".places__list"),k=document.querySelector("#card-template").content;function g(e){e.classList.add("popup_is-opened")}function x(e){e.classList.remove("popup_is-opened")}function A(e,t){t.textContent=e?"Сохранение...":"Сохранить"}f.addEventListener("click",(function(){g(i),s.value=p.textContent,d.value=_.textContent,o(l,e)})),b.addEventListener("click",(function(){g(y),h.reset(),o(h,e)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){return x(e.closest(".popup"))}))})),fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a).then((function(e){u=e._id,p.textContent=e.name,_.textContent=e.about,m.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){return console.log(e)})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=l.querySelector(".popup__button");A(!0,r),r.disabled=!0,(t=s.value,n=d.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then(a)).then((function(e){p.textContent=e.name,_.textContent=e.about,x(i)})).catch((function(e){return console.log(e)})).finally((function(){A(!1,r),r.disabled=!1}))})),h.addEventListener("submit",(function(t){t.preventDefault();var n,r,i=h.querySelector(".popup__button");A(!0,i),i.disabled=!0,(n=v.value,r=S.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n,link:r})}).then(a)).then((function(t){var n;n=function(e){var t=k.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image"),r=t.querySelector(".card__title"),o=t.querySelector(".card__like-button"),i=t.querySelector(".card__delete-button"),l=document.createElement("span");return l.classList.add("card__like-count"),t.querySelector(".card__description").appendChild(l),n.src=e.link,n.alt=e.name,r.textContent=e.name,l.textContent=e.likes?e.likes.length:0,e.likes&&e.likes.some((function(e){return e._id===u}))&&o.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==u&&(i.style.display="none"),o.addEventListener("click",(function(){return function(e,t,n){(t.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(e):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(e)).then((function(e){t.classList.toggle("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}(e._id,o,l)})),i.addEventListener("click",(function(){return function(e,t){(function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then(a)})(t).then((function(){return e.remove()})).catch((function(e){return console.log(e)}))}(t,e._id)})),n.addEventListener("click",(function(){C.src=e.link,C.alt=e.name,E.textContent=e.name,g(q)})),t}(t),L.prepend(n),x(y),h.reset(),o(h,e)})).catch((function(e){return console.log(e)})).finally((function(){A(!1,i),i.disabled=!1}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(o){o.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,o){var c=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(c,a,o),c.forEach((function(e){e.addEventListener("input",(function(){(function(e,r,o){r.validity.valid?n(r,o):function(e,n,r){var o=t(e);e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(r,r.validationMessage,o)})(0,e,o),r(c,a,o)}))}))}(o,e)}))}(e)})();